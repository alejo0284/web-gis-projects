<script>
  require([
    "esri/Map",
    "esri/views/MapView",
    "esri/layers/FeatureLayer",
    "esri/widgets/Legend",
    "esri/widgets/Expand"
  ], (Map, MapView, FeatureLayer, Legend, Expand) => {

    const layer = new FeatureLayer({
      url: "https://services.arcgis.com/h4jNYexE41HKnu98/arcgis/rest/services/US_POP_Web_Map_MIL1/FeatureServer"
    });

    const map = new Map({
      basemap: "streets-night-vector",
      layers: [layer]
    });

    const view = new MapView({
      container: "viewDiv",
      map: map,
      center: [-100, 40], // Centered near Kansas, roughly in the middle of the US
      zoom: 3 // Zoom level should be low to capture all states
    });

    view.when(() => {
      const legend = new Legend({
        view: view,
        layerInfos: [{ layer: layer, title: "US Population in 2015" }]
      });

      const legendExpand = new Expand({
        view: view,
        content: legend,
        expanded: false,
        expandTooltip: "Show Legend"
      });

      view.ui.add(legendExpand, "top-right");
    });
  });
</script>
